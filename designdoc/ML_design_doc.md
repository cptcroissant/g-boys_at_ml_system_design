## Дизайн ML-системы "Создание алгоритма мэтчинга в приложении для знакомств" <MVP> <g-boys>


### 1. Цели и предпосылки 
#### 1.1. Зачем идем в разработку продукта?     

- Бизнес-цель   

Создание инструмента для ранжирования потенциальных партнеров в сервисе по знакомствам. 

В результате - показываем пользователю наиболее подходящих для него партнеров, с максимальной вероятностью совпадения.  
- Почему станет лучше, чем сейчас, от использования ML. 

По причине ухода крупных игроков в сфере сервисов для знакомств после ввода санкций открывается перспектива их замены. Известно, что приложения типа Tinder используют в основе своего подбора кандидатов 
машинное обучение. Модели машинного обучения способны обрабатывать большое количество данных и анализировать интересы пользователя вместо бесчисленных переборов.
Тем самым делая поиск партнера более приятным и менее утомительным. При таком раскладе вовлеченность и удовлетворенность пользователей будет повышена, что открывает возможности для увеличения прибыли сервиса
путем реализации различных бизнес-моделей (показ рекламы бОльшему количеству, увеличение числа премиум подписок).  

На первый взгляд может показаться, что выдавать пользователю сразу наилучший мэтч - нелогично, так как он потратит меньше времени в приложении, меньше будет вовлеченность и, как следствие, меньше монетизация.
Мы отталкиваемся от противоположного мнения. Повышая качество ранжирования потенциальных партнеров мы, во-первых, повышаем удовлетворенность клиентов. Подавляюшему большинству надоедает система, когда интересный для тебя
собеседник появляется только через 50-100 свайпов и ты просто устаешь от бесконечного просмотра профилей. Во-вторых, довольный клиент, который достаточно быстро нашел пару благодаря обновленному алгоритму, с высокой вероятностью посоветую приложение своим друзьям. 
Что привлечет новых клиентов и опять же поспособствует повышению вовлеченности и монетизации. В-третьих, наш подход будет работать на нас в долгосрочной перспективе, так как быстрый и адекватный подбор возможного партнера представит наш сервис в более благоприятном свете, чем ненасытный Тиндер, 
который выдает релевантные мэтчи только с преимум подпиской или при очень длительном пользовании приложения. Позитивный настрой наших клиентов позволит развивать сторонние приложения, которые мы планируем разрабатывать в дальнейшем, имея лояльную клиентскую базу.  


- Назначение проекта

Создание программного модуля, позволяющего  проводить обработку табличных данных пользователей сервиса, строить модель, 
определяющую для каждого пользователя список потенциальных партнеров на основании выставленных фильтров и предпочтений, 
выгружать ранжированный список наиболее подходящих партнеров.

#### 1.2. Бизнес-требования и ограничения  

- Краткое описание БТ и ссылки на детальные документы с бизнес-требованиями   

1. Бизнесовое 1 - повышение скорости "перфект мэтча" через показ максимально близкого по духу человека в начала выдачи результатов. Цель - 8 из 10 первых предложенных людей понравились пользователю и он начал общение;
2. Бизнесовое 2 - повышение лояльности пользователей приложения, минимизация оттока пользователей в пользу конкурентов;
3. Бизнесовое 3 - минимизация нерелевантных показов пользователей с малыми "пересечениями" в интересах; 
4. Техническое 1 - повышение качества выдачи анкет пользователей на основании фильтров и предпочтений текущего юзера; 
5. Техническое 2 - время ранжирования для пользователя при применении фильтров - не более 3 секунд; 
6. Техническое 3 - обернуть модуль в удобный интерфейс, который можно легко масштабировать на большое количество пользователей.

Ссылки на развернутые БТ - в настоящем учебном проекте не планируются.

- Бизнес-ограничения  

1. Возможен дисбаланс классов между мужскими и женскими анкетами, необходимо учитывать это при поиске схожих партнеров
2. Необходимо предусмотреть механизм избегания выдачи анкет с указанием девиантного поведения
3. Даже при небольшой выборке по фильтрам пользователя, необходимо избегать повторных показов одной и той же анкеты в течение, как минимум, одного дня

- Что мы ожидаем от конкретной итерации  

1. Поиск данных для обучения алгоритма ранжирования
2. Подбор и доработка алгоритма ранжинрования анкет на основании пользовательских фильтров
3. Обучение алгоритма из п.2 на данных из п.1
4. Создаение MVP интерфейса для пользователей

- Описание бизнес-процесса пилота, насколько это возможно - как именно мы будем использовать модель в существующем бизнес-процессе?

Алгоритм ранжирования является основой приложения для подбора партнера по запросам пользователя. Желания и потребности пользователя должны максимально учитываться при анализе имеющейся базы данных других пользователей.

- Что считаем успешным пилотом? Критерии успеха и возможные пути развития проекта 

1. Количество "мэтчей" из первой десятки выдачи составляет 50%. 5 анкет, которые показаны в начале нового поиска приводят к началу общения.
2. Новый алгоритм может одновременно обрабатывать до 100 запросов в секунду и выдавать релевантные анкеты
3. Интерфейс интуитивно понятен пользователю, количество жалоб и падений сервиса не превышает 5 в сутки (если считать по пользователям)

#### 1.3. Что входит в скоуп проекта/итерации, что не входит   

- Если говорим про полный проект - закрывает все основные БТ, указанные в п. 1.2 ;
- В случае неудачи, п. 1.2.2 и 1.2.6 могут быть не выполнены. Остальные - обязательны к реализации; 
- Начиная с первой итерации пишем максимально понянтный код, без "индийских" особенностей. Качество кода проверяется через настроенные pre-commit хуки. Основная задача - рабочий алгоритм рекомендации и первая версия интерфейса.  В интерфейсе пользователь выставляет фильтры и пожелания к поиску возможной пары. Алгоритм ранжирования анкет на основании полученных данных осуществляет подбор самых релевантных кандидатов для юзера. 
Анкеты выдаются одна за другой, в первой десятке самый релеватные, но не обязательно, чтобы первая десятка шла в порядке уменьшения релевантности.
- В техдолг попадает доработка интерфейса и фоновый процесс постоянного подбора новых фичей, обновления весов моделей раз в 2-3 месяца и повышения качества ранжирования на основании фоновых ресерчей.

#### 1.4. Предпосылки решения  

- Описание всех общих предпосылок решения, используемых в системе – с обоснованием от запроса бизнеса.   
1. Используем табличные данные с просторов сети. Есть большие датасеты с сайтов знакомств с обезличенными персональными данными, но интересными закономерностями. Понимаем, что рынок и предпочтения в РФ могут отличаться от общемировых, 
но используем эти данные как основные для бейзлайна и доработки моделей. В процессе сбора большого количества данных на локальном рынке будет дорабатывать алгоритм.
2. feature engineering - используем, как уже подготовленные фичи, типа рост-вес-возраст-знак зодиака, так и сгенерированные дополнительно. Например, комбинации из нескольких фичей.


### 2. Методология     
#### 2.1. Постановка задачи  

- Что делаем с технической точки зрения.
Реализовать алгоритм выявления потенциальных партнеров для пользователя сервиса знакомств. 
Тем самым повысив вовлеченность, удовлетворенность пользователей, а также сделав подбор потенциальных партнеров 
более быстрым и менее утомительным. 
Решается задача построения рекомендательной системы и "мэтчинга" на основании запроса первичного пользователя.  
В данной версии не используем фотографии, хоть на них и может приходиться бОльшая часть заинтересованности, работаем только с табличными данными пользователей.   
Дополнительно тестируем гипотезу о том, что при подборе потенциального партнера не на один вечер внутренние качества играют большую роль, чем отретушированное фото в профиле.  

#### 2.2. Блок-схема решения  

- Блок-схема для бейзлайна и основного MVP с ключевыми этапами решения задачи: подготовка данных, построение прогнозных моделей, оптимизация, тестирование, закрытие технического долга, подготовка пилота, другое. 
[![imageup.ru](https://imageup.ru/img88/4521916/001.jpg)](https://imageup.ru/img88/4521916/001.jpg.html)

#### 2.3. Этапы решения задачи  
#### 2.3.1 Командой проекта (со стороны бизнес-заказчика)
•	Сбор описательных характеристик пользователей, зашифровка персональных данных;
•	Пояснительные документы с объяснением характеристик и аномалий в данных;
•	Помощь в разметке совпадений партнеров у пользователей;
•	Помощь в обработке и передачи данных о ходе проведений АБ-тестов и об их результатах;
•	Вынесение выводов, согласование дальнейших процедур в рамках активности выявления потенциальных партнеров.

#### 2.3.2. Внутренним исполнителем (разработчики):
* Анализ прототипа решения (архитектуры, функционала модуля, применимости решения бизнес-задачи, возможности интеграции с существующими системами);
* Анализ результатов 2-х АБ-тестов работы модели, выходных файлов, результатов работы алгоритма;  
* Разметка совпадений для каждого пользователя для обучения алгоритмов и анализа данных;  
* Разработка online и offline метрик качества алгоритма; 
* Разработка модуля мониторинга метрик в режиме реального времени;
* Обзор и сравнение распространенных подходов для решения задачи нахождения потенциального партнера
* Разработка модели по поиску потенциальных партнеров в результате сравнительного обзора 
* Разработка web-интерфейса для визуализации работы алгоритма
* Проверка модели на валидационных данных, поддержка 2 -х АБ-тестов
* Формирования списка гипотез и предложений по улучшению работы реализованного подхода
* Презентация результатов разработки и аналитики 2-х АБ-тестов
* Подготовка и передача отчетных материалов заказчику

- Для каждого этапа **по результатам EDA** описываем - **отдельно для бейзлайна** и **отдельно для основного MVP** - все про данные и технику решения максимально конкретно. Обозначаем необходимые вводные, технику предполагаемого решения и что ожидаем получить на выходе, чтобы перейти к следующему этапу.  
- Как правило, детальное и структурированное заполнение раздела `2.3` возможно только **по результатам EDA**.  
- Если описание в дизайн доке **шаблонно** - т.е. его можно скопировать и применить к разным продуктам, то оно **некорректно**. Дизайн док должен показывать схему решения для конкретной задачи, поставленной в части 1.  
    
> Примеры этапов:  
> - Этап 2 - Подготовка прогнозных моделей  
> - Этап 3 - Интерпретация моделей (согл. с заказчиком)  
> - Этап 4 - Интеграция бизнес правил для расчета бизнес-метрик качества мрдели  
> - Этап 5 - Подготовка инференса модели по итерациям    
> - Этап 6 - Интеграция бизнес правил  
> - Этап 7 - Разработка оптимизатора (выбор оптимальной итерации)  
> - Этап 8 - Подготовка финального отчета для бизнеса  

*Этап 1 - это обычно, подготовка данных.*  

В этом этапе должно быть следующее:  

- Данные и сущности, на которых будет обучаться ваша модель машинного обучения. Отдельная таблица для целевой переменной (либо целевых переменных разных этапов), отдельная таблица – для признаков.  
| Название данных  | Есть ли данные в компании (если да, название источника/витрин) | Требуемый ресурс для получения данных (какие роли нужны) | Проверено ли качество данных (да, нет) |
| ------------- | ------------- | ------------- | ------------- |
| Продажи | DATAMARTS_SALES_PER_DAY  | DE/DS | + |
| ...  | ...  | ... | ... |
 
- Краткое описание результата этапа - что должно быть на выходе: витрины данных, потоки данных, др.  
  
> Чаще всего заполнение раздела невозможно без EDA.

 *Этапы 2 и далее, помимо подготовки данных.*

Описание техники **для каждого этапа** должно включать описание **отдельно для MVP** и **отдельно для бейзлайна**:  

- Описание формирования выборки для обучения, тестирования и валидации. 
- Выбор репрезентативных данных для экспериментов, обучения и подготовки пилота (от бизнес-цели и репрезентативности данных с технической точки зрения) `Data Scientist`
- Горизонт, гранулярность, частоту необходимого пересчета прогнозных моделей    
- Определение целевой переменной, согласованное с бизнесом   
- Какие метрики качества используем и почему они связаны с бизнес-результатом, обозначенным  в разделах `1` и `3`. Пример - WAPE <= 50% для > 80% категорий, bias ~ 0. Возможна формулировка в терминах относительно бейзлайна, количественно. Для бейзлайна могут быть свои целевые метрики, а может их вообще не быть (если это обосновано) `Data Scientist`   
- Необходимый результат этапа. Например, необходимым результатом может быть не просто достижение каких-либо метрик качества, а включение в модели определенных факторов (флаг промо для прогноза выручки, др.) `Data Scientist`    
- Какие могут быть риски и что планируем с этим делать. Например, необходимый для модели фактор (флаг промо) окажется незначимым для большинства моделей. Или для 50% моделей будет недостаточно данных для оценки `Data Scientist`    
- Верхнеуровневые принципы и обоснования для: feature engineering, подбора алгоритма решения, техники кросс-валидации, интерпретации результата (если применимо).  
- Предусмотрена ли бизнес-проверка результата этапа и как будет проводиться  

### 2.5 Ожидаемые результаты:
1. Реализованный программнй модуль в веб-интерфейсе (или telegram-боте)
2.  Отчет о проделанной работе и результатах:
•  Анализ данных пользователей в разрезах и группировках 
•  Сравнение подходов, метрик качества, эволюция решения от базовой модели до финальной версии
•  Выводы моделирования
•  Предложения по доработкам и улучшениям
•  Возможности масштабирования решения
•  Этапы дальнейшей разработки
3. Выводы бизнес-экспертов со стороны заказчика
4. Презентация по результатам пилота, оценка успешности работы алгоритма, направления дальнейшей активности

### 2.5.1 Требования к промежуточной отчетности

Взаимодействие представителя Заказчика и Исполнителя производится еженедельно по пятницам в рамках спринта длительностью в одну неделю посредством либо видео-конференцсвязи, либо очной встречи по предварительной договоренности. Результаты работы Исполнителя представляются в формате презентационных материалов. Ход встречи и возникшие вопросы резюмируются в деловой записке, которая рассылается всем участникам встречи. 

### 2.6 Сроки проекта
Результаты по проекту необходимо передать и согласовать с Заказчиком в срок до 31.12.2023 г. включительно. 

### 2.7	Требования к документированию
По результатам реализации проекта необходимо предоставить:
1.	Отчет, в формате .doсx;
2.	Дашборд, в формате .pbix;
3.	Презентация об итогах реализации проекта, в формате .pptx.
4.	Web-interface, доступный либо разворачиванием с локального компьютера, либо URL, для объяснения работы модели с возможностью визуализировать принятие решений поклиентно 

### 3. Подготовка пилота  
  
#### 3.1. Способ оценки пилота  
  
- Краткое описание предполагаемого дизайна и способа оценки пилота 
  
#### 3.2. Что считаем успешным пилотом  
  
Формализованные в пилоте метрики оценки успешности  
  
#### 3.3. Подготовка пилота  
  
- Что можем позволить себе, исходя из ожидаемых затрат на вычисления. Если исходно просчитать сложно, то описываем этап расчетов ожидаемой вычислительной сложности на эксперименте с бейзлайном. И предусматриваем уточнение параметров пилота и установку ограничений по вычислительной сложности моделей. `Data Scientist` 
### 4. Внедрение `для production систем, если требуется`    

> Заполнение раздела 4 требуется не для всех дизайн документов. В некоторых случаях результатом итерации может быть расчет каких-то значений, далее используемых в бизнес-процессе для пилота.  
  
#### 4.1. Архитектура решения   
  
- Блок схема и пояснения: сервисы, назначения, методы API   
  
#### 4.2. Описание инфраструктуры и масштабируемости 
  
- Какая инфраструктура выбрана и почему 
- Плюсы и минусы выбора 
- Почему финальный выбор лучше других альтернатив 
  
#### 4.3. Требования к работе системы  
  
- SLA, пропускная способность и задержка  
  
#### 4.4. Безопасность системы  
  
- Потенциальная уязвимость системы  
  
#### 4.5. Безопасность данных   
  
- Нет ли нарушений GDPR и других законов 

#### 4.6. Издержки  
  
- Расчетные издержки на работу системы в месяц   
  
#### 4.5. Integration points  
  
- Описание взаимодействия между сервисами (методы API и др.)   
  
#### 4.6. Риски  
  - фейковые анкеты
  - созданные аккаунты с целью мошенничества 
  - потенциальный партнер не равно идеальный или выдуманный  -> реальность не соответствующий ожиданиям
  - предвзятость данных
     - перекос по симпатиями в сторону женщин 
     - наличие извращений в обучающей выборке 
- Описание рисков и неопределенностей, которые стоит предусмотреть
